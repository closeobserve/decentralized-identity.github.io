{% extends "default.html.njk" %}

{% block content %}
  {# Header section #}
  <section class="page-title theme-bg">
    <div class="container">
      <svg viewBox="0 0 50 50">
        <use xlink:href="/images/icons.svg#{{ logo }}"></use>
      </svg>
      <h1>{{ name }}</h1>
      {% if subtitle %}
        <h3>{{ subtitle }}</h3>
      {% else %}
        <h3>{% if type %}{{ type }}{% else %}Working Group{% endif %}</h3>
      {% endif %}
      {% if shortform %}
        <h4>aka: {{ shortform }}</h4>
      {% endif %}
    </div>
  </section>

  {# Scope section #}
  {% include "partials/wg/scope.html.njk" %}

  {# Projects section #}
  {% include "partials/wg/projects.html.njk" %}

  {# Repositories section - placed right after projects #}
  {% if repoTag %}
    <!-- Fetch and display repositories -->
    <script>
      // Wait for the DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Wait a bit to ensure all elements are rendered
        setTimeout(function() {
          fetch('https://api.github.com/orgs/decentralized-identity/repos')
            .then(response => response.json())
            .then(data => {
              const repos = data.filter(repo => 
                repo.name.includes('{{ repoTag }}') || 
                (repo.topics && repo.topics.includes('{{ repoTag }}'))
              );
              
              if (repos.length > 0) {
                // Create the repositories section
                const repoSection = document.createElement('section');
                repoSection.className = 'counter-section';
                repoSection.innerHTML = `
                  <div class="container">
                    <div class="row justify-content-center m-45px-b md-m-20px-b sm-m-15px-b">
                      <div class="col-12 col-md-10 col-lg-7">
                        <div class="section-title text-center">
                          <h2 class="font-alt">All Repositories</h2>
                          <div class="title-border">
                            <span class="lg"></span><span class="md"></span><span class="sm"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row justify-content-center">
                      <div class="col-10 col-md-8 col-lg-6 m-30px-t margin-center">
                        <dl id="repo-list"></dl>
                      </div>
                    </div>
                  </div>
                `;
                
                // Find the projects section by its heading text
                const projectsSection = Array.from(document.querySelectorAll('.section-title h2'))
                  .find(h2 => h2.textContent.includes('Specs & Projects'))
                  ?.closest('.counter-section');
                
                // Insert after the projects section if found, otherwise append to body
                if (projectsSection) {
                  projectsSection.parentNode.insertBefore(repoSection, projectsSection.nextSibling);
                } else {
                  document.body.appendChild(repoSection);
                }
                
                // Add repositories to the list
                const repoList = document.getElementById('repo-list');
                repos.forEach(repo => {
                  const dt = document.createElement('dt');
                  const dd = document.createElement('dd');
                  
                  dt.innerHTML = `
                    <a href="${repo.html_url}">
                      <svg style="fill: #000;"><use xlink:href="/images/icons.svg#github"></use></svg>
                      ${repo.name}
                    </a>
                  `;
                  
                  dd.innerHTML = `
                    <p>${repo.description || ''}</p>
                  `;
                  
                  repoList.appendChild(dt);
                  repoList.appendChild(dd);
                });
              }
            })
            .catch(error => console.error('Error fetching repositories:', error));
        }, 500); // Small delay to ensure DOM is fully rendered
      });
    </script>
  {% endif %}

  {# Chairs section #}
  {% include "partials/wg/chairs.html.njk" %}

  {# Optional liaison section #}
  {% if liaison %}
    {% include "partials/wg/liaison.html.njk" %}
  {% endif %}

  {# Optional editors section #}
  {% if editors %}
    {% include "partials/wg/editors.html.njk" %}
  {% endif %}
{% endblock %} 